 <!DOCTYPE html>
<html>
<head lang="en">
  <title>ONC Family Assistance Request</title>
  <script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
  <script>
  
  	/* Comment the correct line for live vs local */    
	//	var url ="http://cfs.idtus.com:8902";
	var url ="http://localhost:8902"
  
  	var urlChildren = url.concat("/children?token=REPLACE_TOKEN&year=YEAR&famid=FAMID&callback=?");
  	var urlAdults = url.concat("/adults?token=REPLACE_TOKEN&year=YEAR&famid=FAMID&callback=?");
  	
  	var childrenJson;
  	var adultsJson;
  	
  	$( document ).ready(function()
	{
  		$.getJSON(urlChildren, function(data)
  		{
  		     childrenJson = data;
  		     updateChildTable();
  		     updateWishTable();
  		});
  		
  		$.getJSON(urlAdults, function(data)
  		{
  		     adultsJson = data;
  		     updateAdultTable();
  		});
  		
  		$(function() {
  		    $("form input").keypress(function (e) {
  		        if ((e.which && e.which == 13) || (e.keyCode && e.keyCode == 13)) {
  		            $('button[type=submit] .default').click();
  		            return false;
  		        } else {
  		            return true;
  		        }
  		    });
  		});
  		
  		$('html').bind('keypress', function(e)
  		{
  			if(e.keyCode == 13)
  			{
  				return false;
  			}
  		});
	});	
	
	function updateChildTable()
    {
    	$("#tchildbody").empty();
    	
    	for(var i=0; i<childrenJson.length; i++)
		{
    		addChildTableRow(childrenJson[i]);	//add row to table
		}
    }
	
	function updateWishTable()
    {
    	$("#twishbody").empty();
    	
    	for(var i=0; i<childrenJson.length; i++)
		{
    		addWishTableRow(childrenJson[i]);	//add row to table
		}
    }
	
	function updateAdultTable()
    {
    	$("#tadultbody").empty();
    	
    	for(var i=0; i<adultsJson.length; i++)
		{
    		addAdultTableRow(adultsJson[i]);	//add row to table
		}
    }
	
	function addChildTableRow(child)
    {
        if (!document.getElementsByTagName) return;
        
        var childinfo = [child.firstname, child.lastname, child.sDOB, child.gender, child.school];
        
	    var tabBody = document.getElementById("childtable").getElementsByTagName('tbody').item(0);
        row=document.createElement("tr");
         
        for(index=0; index < childinfo.length; index++)	//create the child info cells
        {
        	cell = document.createElement("td");
        	cell.appendChild(document.createTextNode(childinfo[index]));
        	row.appendChild(cell);
        }
        
        btn = document.createElement("button");
        btn.value=child.firstName;
        btn.type="button";
        btn.innerHTML = "Remove";
        btn.onclick=function() {removeChild(child.firstname);};
        row.appendChild(btn);
        
        tabBody.appendChild(row);
    }
	
	function addWishTableRow(child)
    {
        if (!document.getElementsByTagName) return;
        
        var childinfo = [child.firstname, child.lastname];
        
	    var tabBody = document.getElementById("wishtable").getElementsByTagName('tbody').item(0);
        row=document.createElement("tr");
         
        for(index=0; index < childinfo.length; index++)	//create the child info cells
        {
        	cell = document.createElement("td");
        	cell.appendChild(document.createTextNode(childinfo[index]));
        	row.appendChild(cell);
        }
        
        var wishlist= document.createElement("input");
        wishlist.type="input";
        wishlist.placeholder= "Wish list for " + child.childFirstName;
        wishlist.setAttribute("size", 120);
        row.appendChild(wishlist);
        
        tabBody.appendChild(row);
    }
	
	function addAdultTableRow(adult)
    {
        if (!document.getElementsByTagName) return;
        
        var adultinfo = [adult.name, adult.gender];
        
	    var tabBody = document.getElementById("adulttable").getElementsByTagName('tbody').item(0);
        row=document.createElement("tr");
         
        for(index=0; index < adultnfo.length; index++)	//create the child info cells
        {
        	cell = document.createElement("td");
        	cell.appendChild(document.createTextNode(adultinfo[index]));
        	row.appendChild(cell);
        }
        
        btn = document.createElement("button");
        btn.value=child.id;
        btn.type="button";
        btn.innerHTML = "Remove";
        btn.onclick=function() {removeAdult(adult.id);};
        row.appendChild(btn);
        
        tabBody.appendChild(row);
    }
	
	function addChild()
	{
        var child = {}
        child["firstname"] = document.getElementById('childfn').value;
        child["lastname"] = document.getElementById('childln').value;
        child["sDOB"] = document.getElementById('childdob').value;
        child["gender"] = document.getElementById('childgender').value;
        child["school"] = document.getElementById('school').value;
        childrenJson.push(child);
        
        updateChildTable();
        updateWishTable();
        
        clearAddChild();  
	}
	
	function clearAddChild()
	{
		document.getElementById('childfn').value="";
        document.getElementById('childln').value="";
        document.getElementById('childdob').value="";
        document.getElementById('childgender').value="Boy";
        document.getElementById('school').value="";
	}
	
	function removeChild(id)
	{
		console.log(id);
		var index=0;
		while(index<childrenJson.length && childrenJson[index].id != id)
			index++;
		
		if(index < childrenJson.length)
			alert("Remove " + childrenJson[index].childLastName)
		else
			alert("Child not found");	
	}
	
	function removeAdult(id)
	{
		
	}
	
	function sameAddressClicked(cb)
	{
		if(cb.checked == true)
		{
			document.getElementById('delhousenum').value = document.getElementById('housenum').value;
			document.getElementById('delstreet').value = document.getElementById('street').value;
			document.getElementById('delunit').value = document.getElementById('unit').value;
			document.getElementById('delcity').value = document.getElementById('city').value;
			document.getElementById('delzipcode').value = document.getElementById('zipcode').value;
		}
		else
		{
			document.getElementById('delhousenum').value = "";
			document.getElementById('delstreet').value = "";
			document.getElementById('delunit').value = "";
			document.getElementById('delcity').value = "";
			document.getElementById('delzipcode').selectedIndex = 0;
		}
	}
  </script>
  <style>
	.gray {background-color: #E8E8E8;}
	.orange {background-color: #FFCC99;}
  </style>
</head>
<body>
	<p>ONC Family Referral Form - Please complete and click submit
	<form>
  <fieldset class="gray">
    <legend>Head of Household Information:</legend>
    <input title="First Name" name="hohFN" type="text" size="20" placeholder="First Name" value="HOHFIRSTNAME">
    <input name="hohLN" type="text" size="20" placeholder="Last Name", value="HOHLASTNAME">
    <input name="homephone" type="text" size="20" placeholder="Primary Phone">
    <input name="cellphone" type="text" size="20" placeholder="Alternate Phone">
  	<select name="language">
		<option value="English">English</option>
		<option value="Spanish">Spanish</option>
		<option value="Arabic">Arabic</option>
		<option value="Korean">Korean</option>
		<option value="Vietnamese">Vietnamese</option>
		<option value="Other">Other</option>
		<option value="?">Unknown</option>
	</select>
	<br>
	<input id="housenum" name="housenum" type="text" size="8" placeholder="House #">
    <input id="street" name="street" type="text" size="20" placeholder="Street Name">
    <input id="unit" name="unit" type="text" size="8" placeholder="Apt #">
    <input id="city" name="city" type="text" size="20" placeholder="City">
    <select id="zipcode" name="zipcode">
		<option value="20120">20120</option>
		<option value="20121">20121</option>
		<option value="20124">20124</option>
		<option value="20151">20151</option>
		<option value="22033">22033</option>
		<option value="22039">22039</option>
	</select>
	<input name="email" type="email" size="30" placeholder="email address">
  </fieldset>
  <br>
  <fieldset class="orange">
	<legend>Delivery Address (ONC will deliver gifts to this address):</legend>
	<input type="checkbox" id="sameaddress" onclick="sameAddressClicked(this)" name="sameaddress" value="same" />Check if same as HOH address
	<input id="delhousenum" name="delhousenum" type="text" size="8" placeholder="House #">
    <input id="delstreet" name="delstreet" type="text" size="20" placeholder="Street Name">
    <input id="delunit" name="delunit" type="text" size="8" placeholder="Apt #">
    <input id="delcity" name="delcity" type="text" size="20" placeholder="City">
    <select id="delzipcode" name="delzipcode">
		<option value="20120">20120</option>
		<option value="20121">20121</option>
		<option value="20124">20124</option>
		<option value="20151">20151</option>
		<option value="22033">22033</option>
		<option value="22039">22039</option>
	</select>
  </fieldset>
  <br>
  <fieldset class="gray">
  	<legend>Family Members</legend>
  <fieldset class="gray">
  	<legend>Children in family (ONC will serve children under 18, or 18+ and still enrolled in FCPS)</legend>
  	<input id="childfn" name="childfn" type="text" size="20" placeholder="First Name">
    <input id="childln" name="childln" type="text" size="20" placeholder="Last Name">
    <input id="childdob" name="childdob" type="date" size="20" placeholder="DoB">
    <select id="childgender" name="childgender">
		<option value="Boy">Boy</option>
		<option value="Girl">Girl</option>
		<option value="Unknown">Unknown</option>
	</select>
	<input id="school" name="school" type="text" size="20" placeholder="School">
	<button type="button" onclick="addChild()">Add Child</button>
	<button type="button" onclick="clearAddChild()">Clear</button>
  <table id="childtable" border="1">
  	<thead>
    	<tr>
        	<th>First Name</th>
        	<th>Last Name</th>
        	<th>DoB </th>
        	<th>Gender </th>
        	<th>School </th>
    	</tr>
      </thead>
      <tbody id="tchildbody">
      </tbody>
  </table>
  </fieldset>
  <br>
  <fieldset class="gray">
  	<legend>Other Adults in family (Adults in addition to HOH)</legend>
  	<input name="adultfn" type="text" size="20" placeholder="First Name">
    <input name="adultln" type="text" size="20" placeholder="Last Name">
    <select name="adultgender">
		<option value="Male">Male</option>
		<option value="Female">Female</option>
		<option value="Unknown">Unknown</option>
	</select>
	<button type="button">Add Adult</button>
  <table id="adulttable" border="1">
  	<thead>
    	<tr>
        	<th>First & Last Name</th>
        	<th>Gender </th>
    	</tr>
    </thead>
    <tbody id="tadultbody">
    </tbody>
</table>
  </fieldset>
  </fieldset>
  <br>
  <fieldset class="orange">
  	<legend>Gift Assistance: Complete for each child in family</legend>
  	 <table id="wishtable" border="1">
  	<thead>
    	<tr>
        	<th>First Name</th>
        	<th>Last Name</th>
        	<th>Wish List: 3 wishes in order of importance per child; if clothing, include size & color preference </th>
    	</tr>
      </thead>
      <tbody id="twishbody">
      </tbody>
  </table>
  </fieldset>
   <br>
  <fieldset class="gray">
	<legend>Meal Assistance (ONC will refer family to WFCM or equivalent):</legend>
	<input type="checkbox" name="mealrqrd" value="mealrqrd" />Check to request meal assistance for:
    <select name="mealtype">
		<option value="Thanksgiving">Thanksgiving</option>
		<option value="December Holiday">December Holiday</option>
		<option value="Both">Both</option>
	</select>
	<input type="text" name="dietres" size="56" placeholder="Describe any deitary restrictions">
  </fieldset>
  <br>
  <fieldset class=orange>
	<legend>Family Details (Details about family you think ONC should know):</legend>
	<input type="text" name="detail" size="132" height="44" placeholder="Details about family ONC should know">
  </fieldset>
  <br>
  <input id="submit"  formaction="" type="submit" value="Submit to ONC">Please check that all fields are completed!
</form>
</body>
</html>   