<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <title>ONC Partner Page</title>
  <script src="//code.jquery.com/jquery-1.10.2.js"></script>
  <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
  <link rel="stylesheet" type="text/css" href="oncstylesheet.css">
  <link rel="stylesheet" type="text/css" href="oncdialogstylesheet.css">
  <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css">
  <script> 
  	var errorColor = '#FF9999';
  	
  	$( document ).ready(function()
	{
  		//set the hidden values
  		document.getElementById('year').value= new Date().getFullYear().toString();
  		document.getElementById('token').value= sessionStorage.getItem("token");
  		document.getElementById('partnerid').value= sessionStorage.getItem("partnerid");
  		
  		//update the nav bar links with token
  		document.getElementById('logoutlink').href="logout?token=" + sessionStorage.getItem('token'); 
  		document.getElementById('homelink').href="startpage?token=" + sessionStorage.getItem('token')
		 +'&year=' + sessionStorage.getItem('curryear') +'&famref=' + sessionStorage.getItem('famref');
  		
  		if(sessionStorage.getItem("partnerid") !== "New")
  		{
  			partnerparams = "token=" + sessionStorage.getItem("token") + "&" +
				"year=" + sessionStorage.getItem('curryear') + "&" +
				"partnerid=" + sessionStorage.getItem("partnerid") + "&" +
				"callback=?";

			$.getJSON('getpartner', partnerparams, function(partner)
			{
				//fill in partner info here
				document.getElementById('partid').value= partner.id;
				document.getElementById('partln').value= partner.lastName;
				document.getElementById('partfn').value= partner.firstName;
				document.getElementById('type').value= partner.type;
				document.getElementById('status').value= partner.status;
				document.getElementById('collection').value= partner.collection;
				document.getElementById('housenum').value= partner.houseNum;
				document.getElementById('street').value= partner.street;
				document.getElementById('unit').value= partner.unit;
				document.getElementById('city').value= partner.city;
				document.getElementById('zipcode').value= partner.zipCode;
				document.getElementById('firstcontactname').value= partner.contact;
				document.getElementById('firstcontactemail').value= partner.contact_email;
				document.getElementById('firstcontactphone').value= partner.contact_phone;
				document.getElementById('secondcontactname').value= partner.contact2;
				document.getElementById('secondcontactemail').value= partner.contact2_email;
				document.getElementById('secondcontactphone').value= partner.contact2_phone;
				document.getElementById('genTA').value= partner.other;
				document.getElementById('cyTA').value= partner.specialNotes;
				document.getElementById('delTA').value= partner.deliverTo;
				document.getElementById('pyReq').value= partner.pyRequested;
				document.getElementById('pyAss').value= partner.pyAssigned;
				document.getElementById('pyDel').value= partner.pyDelivered;
				document.getElementById('pyRec').value= partner.pyReceivedBeforeDeadline;
				document.getElementById('pyLate').value= partner.pyReceivedAfterDeadline;
				document.getElementById('cyReq').value= partner.orn_req;
				document.getElementById('cyAss').value= partner.orn_assigned;
				document.getElementById('cyDel').value= partner.orn_delivered;
				document.getElementById('cyRec').value= partner.orn_rec_before;
				document.getElementById('cyLate').value= partner.orn_rec_after;
			});
  		}
  		else
  		{
  			document.getElementById('partid').value= "New";
  		}
  		
//  		$(function() {
//  		    $("form input").keypress(function (e) {
//  		        if ((e.which && e.which == 13) || (e.keyCode && e.keyCode == 13)) {
//  		            $('button[type=submit] .default').click();
//  		            return false;
//  		        } else {
//  		            return true;
//  		        }
//  		    });
//  		});
//  		
//  		$('html').bind('keypress', function(e)
//  		{
//  			if(e.keyCode == 13)
//  			{
//  				return false;
//  			}
//  		});
	});
  	
  	function verifyPhoneNumber(elementNum)
  	{
  		var phoneElement= [document.getElementById('phone'), 
  							document.getElementById('firstcontactphone'),
  							document.getElementById('secondcontactphone')];
  		
  		var numberGood = true;
  		var number= phoneElement[elementNum].value;
  		
  		if(number == '')
  			phoneElement[elementNum].style.backgroundColor = '#FFFFFF';
  		else if(number.length===12 && number.charAt(3)==='-' && number.charAt(7)==='-')
  			phoneElement[elementNum].style.backgroundColor = '#FFFFFF';
  		else if(number.length===12 && number.charAt(3)==='.' && number.charAt(7)==='.')
  			phoneElement[elementNum].style.backgroundColor = '#FFFFFF';
  		else if(number.length===10 && number.indexOf("-")===-1 && number.indexOf(".")===-1)
  			phoneElement[elementNum].style.backgroundColor = '#FFFFFF';
  		else
  		{
  			numberGood= false;
  			phoneElement[elementNum].style.backgroundColor = errorColor;
  		}
  		
  		return numberGood;
  	}
	
	function onSessionTimeout()
	{
		 window.location.assign('timeout');
	}
	
	function onSubmit()
	{
		document.getElementById("updatepartner").submit();
	}

  </script>
  <style>
  	.right-justify
  	{
  		text-align:right;
  	}
  	.fieldsetdiv
  	{
  		margin-top:6px;
  	}
  	textarea 
  	{
    	height: 120px;
    	padding: 2px 2px;
    	box-sizing: border-box;
    	border: 1px solid #ccc;
    	border-radius: 4px;
    	background-color: #f8f8f8;
    	resize: none;
    	display: block;
	}
	#genTA { width: 300px; }
	#cyTA { width: 300px; }
	#delTA { width: 150px; }
	#submitspan {float: right;}
	#errormessage
	{
		float: left;
		font-weight: bold;
		font-style: italic;
		color: red;
	}
  </style>
</head>
<body>
  <a href="#timeoutdlg" id="timeoutanchor" style="visibility: hidden">Timeout</a>
  <div id="topbar" class="topbar">
    <img src="onclogo" height="55" width="75"/>
    <p><span id="banner">ONC Partner Form</span><br>
	<span id="message">(please complete and click Submit To add or update a partner)</span></p>
  </div>
  <nav>
    <ul>
	    <li id="homeli"><a id='homelink'>Home</a></li>
	</ul>
	<ul class='floatright'>
	    <li id="logoutli"><a id='logoutlink'>Logout</a></li>
	</ul>
  </nav>
  <form id="updatepartner" action="updatepartner" method="post">
  <input id='token' type="hidden" name="token">
  <input id='year' type="hidden" name="year">
  <input id='partnerid' type="hidden" name="partnerid">
  <fieldset>
  <legend class="legend-major">Partner Information</legend>
  	<div>
  	<label for='partid'>Partner ID:</label>
  	<input id='partid' type='text' size='8' readonly>
    <label for='partln'>Last or Organization Name:</label>
    <input id='partln' title="Organization or Last Name" name="lastname" type="text" size="48" required>
    <label for='partfn'>First Name:</label>
    <input id='partfn' title="First Name" name="firstname" type="text" size="12">
    </div>
    <div class='fieldsetdiv'>
    <label for='type'>Type:</label>
	<select id="type" title="Type" name="type">
      <option value="Business">Business</option>
	  <option value="Church">Church</option>
	  <option value="School">School</option>
	  <option value="Clothing">Clothing</option>
	  <option value="Coat">Coat</option>
	  <option value="ONC Shopper">ONC Shopper</option>
	</select>
	<label for='status'>Status:</label>
	<select id="status" title="status" name="status">
      <option value="No Action Yet">No Action Yet</option>
	  <option value="1st Email Sent">1st Email Sent</option>
	  <option value="Responded">Responded</option>
	  <option value="2nd Email Sent">2nd Email Sent</option>
	  <option value="Called, Left Mssg">Called, Left Mssg</option>
	  <option value="Confirmed">Confirmed</option>
	  <option value="Not Participating">Not Participating</option>
	</select>
	<label for='collection'>Collection:</label>
	<select id="collection" title="collection" name="collection">
	  <option value="General">General</option>
	  <option value="Ornament">Ornament</option>
	  <option value="Meals">Meals</option>
	  <option value="Unknown">Unknown</option>
	</select>
	</div>
	<div class='fieldsetdiv'>
	<label for='housenum'>Address:</label>
	<input id="housenum" title="House #" name="housenum" type="text" size="7" placeholder="House #" autocomplete="off">
    <input id="street" title="Street Name" name="street" type="text" size="24" placeholder="Street Name"  autocomplete="off">
    <input id="unit" title="Apt. or Unit #" name="unit" type="text" size="8" placeholder="Unit #" autocomplete="off">
    <input id="city" title="City" name="city" size='20' placeholder="City">	
    <input id="zipcode" title="Zip Code" name="zipcode" size='8' placeholder="Zip Code">
    <label for='phone'>Phone #:</label>
    <input id="phone" title="Phone #" name="phone" type="text" size="12" placeholder="Phone #" onchange="verifyPhoneNumber(0)">
    </div>
  </fieldset>
  <fieldset>
  <legend class="legend-major">Contact Information</legend>
  	<div>
  	<label for='firstcontactname'>1st Contact:</label>
	<input id="firstcontactname" title="1st Contact Name" name="firstcontactname" type="text" size="20" placeholder="1st Contact Name" autocomplete="off">
	<label for='firstcontactemail'>Email:</label>
	<input id='firstcontactemail' title="1st Contact Email address" name="firstcontactemail" type="email" size="30" placeholder="1st Contact Email Address">
	<label for='firstcontactphone'>Phone:</label>
	<input id="firstcontactphone" title="1st Contact Phone #" name="firstcontactphone" type="text" size="18" placeholder="1st Contact Phone #" onchange="verifyPhoneNumber(1)">
	</div>
	<div class='fieldsetdiv'>
	<label for='secondcontactname'>2nd Contact:</label>
	<input id="secondcontactname" title="2nd Contact Name" name="secondcontactname" type="text" size="20" placeholder="2nd Contact Name" autocomplete="off">
	<label for='secondcontactemail'>Email:</label>
	<input id='secondcontactemail' title="2nd Contact Email address" name="secondcontactemail" type="email" size="30" placeholder="2nd Contact Email Address">
	<label for='secondcontactphone'>Phone:</label>
	<input id="secondcontactphone" title="2nd Contact Phone #" name="secondcontactphone" type="text" size="18" placeholder="2nd Contact Phone #" onchange="verifyPhoneNumber(2)">
	</div>
  </fieldset>
  <fieldset>
    <legend class="legend-major">General Partner Information, Current Year Notes And Gift Delivery Information</legend>
      <fieldset class='floatleft'> 
	  	<legend>General Partner Information</legend>
    	<textarea id='genTA' name='genTA' placeholder='Enter general partner info here'></textarea>
      </fieldset>
      <fieldset class='floatleft'>
      	<legend>Current Year Notes</legend>
    	<textarea id='cyTA' name='cyTA' placeholder='Enter current year partner info here'></textarea>
     </fieldset>
     <fieldset class='floatleft'>
     	<legend>Gift Delivery Information</legend>
    	<textarea id='delTA' name='delTA' placeholder='Enter gift delivery info here'></textarea>
     </fieldset>
  </fieldset>
  <fieldset>
  	<legend class='legend-major'>Partner Performance Information</legend>
  	<div>
  	<label for='pyReq'>Prior Year Request:</label>
  	<input id="pyReq" class='right-justify' title="Prior Year Req." type="text" size="4" readonly>
  	<label for='pyAss'>Assigned:</label>
  	<input id="pyAss" class='right-justify' title="Prior Year Assigned." type="text" size="4" readonly>
  	<label for='pyDel'>Delivered:</label>
  	<input id="pyDel" class='right-justify' title="Prior Year Delivered" type="text" size="4" readonly>
  	<label for='pyRec'>On Time:</label>
  	<input id="pyRec" class='right-justify' title="Prior Year Received" type="text" size="4" readonly>
  	<label for='pyLate'>Late:</label>
  	<input id="pyLate" class='right-justify' title="Prior Year late." type="text" size="4" readonly>
  	</div>
  	<div class='fieldsetdiv'>
  	<label for='cyReq'>Current Year Request:</label>
  	<input id="cyReq" class='right-justify' name='cyReq' title="Prior Year Req." type="text" size="4">
  	<label for='cyAss'>Assigned:</label>
  	<input id="cyAss" class='right-justify' title="Prior Year Assigned." type="text" size="4" readonly>
  	<label for='cyDel'>Delivered:</label>
  	<input id="cyDel" class='right-justify' title="Prior Year Delivered" type="text" size="4" readonly>
  	<label for='cyRec'>On Time:</label>
  	<input id="cyRec" class='right-justify' title="Prior Year Received" type="text" size="4" readonly>
  	<label for='cyLate'>Late:</label>
  	<input id="cyLate" class='right-justify' title="Prior Year late." type="text" size="4" readonly>
  	</div>
  </fieldset>
  <br>
  <div>
  	<span id="errormessage"></span>
  	<span id="submitspan">
  	  <label for="submit">Please check that all fields are complete prior to submission: </label>
  	  <input id="btnsubmit" type="button" value="Submit" style="background-color: #336699; color: #ffffff;" title="Click to sumbit partner to ONC" onclick= onSubmit()>
<!--  <input id="submit" type="submit" value="Submit to ONC" style="background-color: #808080; color: #ffffff;" title="Click to sumbit partner to ONC"> -->  
  	</span>
  </div>
</form>
<!-- Timeout Dialog -->
  <div id="timeoutdlg" class="modalDialog">
	<div id='inner'>
		<div id='dialogtopbar'>
		  <img src="onclogo" height="45" width="65"/>
		  <span id='dialogmssg'>Session Timeout</span>
		</div>
		<p id='to_mssg'>Your session expired due to inactivity</p>
    	<div id='buttonbar'>
      	  <button id="timeoutsubmit" onclick="onSessionTimeout()">Logout</button>
    	</div> 
	</div>
  </div>    
</body>
</html> 